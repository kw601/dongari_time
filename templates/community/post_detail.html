<!-- 게시글 상세 페이지 (경로 : 게시판 페이지에서 게시글 클릭 시) -->
{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/community/post_detail.css' %}" />

<div class="p_d_container">
    <div class="board_name_box">
        <h1 class="p_d_h1">{{ board.board_name }}</h1>
    </div>
    <hr class="hr_2px">
    <h2 class="p_d_h2">{{ post.title }}</h2>
    {% if post.image %}
    <img src="{{ post.image.url }}" alt="Post Image" class="p_d_image">
    {% endif %}
    <p class="comment-author p_d_p">작성자:
        {% if post.user_id and not post.anonymous %}
        {{ post.user_id.nickname }}
        {% else %}
        익명
        {% endif %}
        | 작성일시: {{ post.created_time }}
    </p>
    <p class="p_d_p">{{ post.content }}</p>
    <p class="p_d_p">댓글: {{ comments.count }}</p>
    <div class="post-actions">
        <button id="scrap-btn" data-post-id="{{ post.id }}" data-is-scraped="{{ is_scraped|lower }}">
            {% if user in post.scraps.all %}스크랩 취소{% else %}스크랩{% endif %}
        </button>
        <button id="like-btn" data-post-id="{{ post.id }}" data-is-liked="{{ is_liked|lower }}">
            {% if is_liked %}좋아요 취소{% else %}좋아요{% endif %}
            <span id="like-count">{{ likes_count }}</span>
        </button>
    </div>
    <hr class="hr_2px">
    <h3 class="p_d_h3">댓글</h3>
    <div class="p_d_comment-section">
        {% for comment in comments %}
        <div class="p_d_comment">
            <p class="p_d_comment-author p_d_p">작성자:
                {% if comment.user_id and not comment.anonymous %}
                {{ comment.user_id.nickname }}
                {% else %}
                익명
                {% endif %}
                | 작성일시: {{ comment.created_time }}
            </p>
            <p class="p_d_p">{{ comment.content }}</p>
            {% if user == comment.user_id %}
            <form action="{% url 'community:delete_comment' comment.id %}" method="post">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('정말로 이 댓글을 삭제하시겠습니까?')">삭제</button>
            </form>
            {% endif %}
        </div>
        <hr class="hr_1px">
        {% endfor %}
    </div>
    <h3 class="p_d_h3_comment">댓글 작성</h3>
    <form class="p_d_comment_form" method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">댓글 작성</button>
    </form>
    <a href="{% url 'community:post_list' board.id %}">게시판 목록</a>
</div>

<script src="{% static 'js/community/post_detail.js' %}"></script>

{% endblock content %}